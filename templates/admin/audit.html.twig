{% extends 'admin/layout.html.twig' %}

{% block title %}Audit Logs
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<style>
		.audit-panel {
			background: var(--card-bg);
			backdrop-filter: blur(16px);
			border: 1px solid var(--border-glass);
			border-radius: 28 px);
			padding: 2rem;
			overflow: hidden;
		}

		.audit-table {
			width: 100%;
			border-collapse: collapse;
			margin-top: 1rem;
		}

		.audit-table th {
			text-align: left;
			padding: 1.25rem 1rem;
			color: var(--text-secondary);
			font-size: 0.85rem;
			font-weight: 700;
			text-transform: uppercase;
			letter-spacing: 0.05em;
			border-bottom: 1px solid var(--border-glass);
		}

		.audit-table td {
			padding: 1.25rem 1rem;
			border-bottom: 1px solid rgba(255, 255, 255, 0.05);
			vertical-align: middle;
		}

		.audit-row:hover {
			background: rgba(255, 255, 255, 0.02);
		}

		.severity-badge {
			padding: 4px 10px;
			border-radius: 8px;
			font-size: 0.7rem;
			font-weight: 800;
			text-transform: uppercase;
		}

		.severity-info {
			background: rgba(59, 130, 246, 0.1);
			color: #3b82f6;
			border: 1px solid rgba(59, 130, 246, 0.2);
		}
		.severity-warning {
			background: rgba(245, 158, 11, 0.1);
			color: #f59e0b;
			border: 1px solid rgba(245, 158, 11, 0.2);
		}
		.severity-critical {
			background: rgba(239, 68, 68, 0.1);
			color: #ef4444;
			border: 1px solid rgba(239, 68, 68, 0.2);
		}

		.event-type-chip {
			display: inline-flex;
			align-items: center;
			gap: 0.5rem;
			padding: 6px 12px;
			border-radius: 20px;
			font-size: 0.8rem;
			font-weight: 600;
			background: rgba(255, 255, 255, 0.05);
			color: var(--text-primary);
		}

		.user-cell {
			display: flex;
			align-items: center;
			gap: 0.75rem;
		}

		.user-avatar {
			width: 32px;
			height: 32px;
			border-radius: 50%;
			background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 0.75rem;
			font-weight: 700;
			color: white;
		}

		.timestamp {
			font-size: 0.85rem;
			color: var(--text-secondary);
			font-family: monospace;
		}

		.ip-address {
			font-family: monospace;
			font-size: 0.8rem;
			color: var(--accent-blue);
			background: rgba(59, 130, 246, 0.1);
			padding: 4px 8px;
			border-radius: 6px;
		}
	</style>
{% endblock %}

{% block admin_content %}
	<header class="page-header">
		<div>
			<h1 class="page-title">Global Audit Log</h1>
			<p style="color: var(--text-secondary); font-weight: 500;">The "Black Box" - Complete forensic trail of all system events</p>
		</div>
		<div style="display: flex; gap: 1rem;">
			<div style="background: rgba(59, 130, 246, 0.1); padding: 0.75rem 1.25rem; border-radius: 16px; border: 1px solid rgba(59, 130, 246, 0.2);">
				<span style="font-weight: 700; color: var(--accent-blue);">{{ logs|length }}
					Recent Events</span>
			</div>
		</div>
	</header>

	<div class="audit-panel">
		<table class="audit-table">
			<thead>
				<tr>
					<th>Timestamp</th>
					<th>Event Type</th>
					<th>Description</th>
					<th>User</th>
					<th>IP Address</th>
					<th>Severity</th>
				</tr>
			</thead>
			<tbody>
				{% for log in logs %}
					<tr class="audit-row">
						<td>
							<span class="timestamp">{{ log.createdAt|date('Y-m-d H:i:s') }}</span>
						</td>
						<td>
							<div class="event-type-chip">
								<span style="opacity: 0.7; font-size: 0.7rem;">●</span>
								{{ log.eventType|replace({'_': ' ', '.': ' › '})|title }}
							</div>
						</td>
						<td style="color: var(--text-primary); font-size: 0.9rem;">
							{{ log.eventDescription }}
						</td>
						<td>
							{% if log.user %}
								<div class="user-cell">
									<div class="user-avatar">
										{{ log.user.firstName|slice(0,1) }}{{ log.user.lastName|slice(0,1) }}
									</div>
									<span style="color: white; font-weight: 600;">{{ log.user.email }}</span>
								</div>
							{% else %}
								<span style="color: var(--text-secondary); font-style: italic;">System</span>
							{% endif %}
						</td>
						<td>
							{% if log.ipAddress %}
								<span class="ip-address">{{ log.ipAddress }}</span>
							{% else %}
								<span style="color: var(--text-secondary);">—</span>
							{% endif %}
						</td>
						<td>
							<span class="severity-badge severity-{{ log.severity }}">{{ log.severity|upper }}</span>
						</td>
					</tr>
				{% else %}
					<tr>
						<td colspan="6" style="text-align: center; padding: 4rem; color: var(--text-secondary);">
							No audit events recorded yet.
						</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
{% endblock %}
